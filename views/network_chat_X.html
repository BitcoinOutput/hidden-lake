{{ define "title" }}
    Chat
{{ end }}

{{ define "content" }}
    <div class="wrapper">
        <p class="block_left"> /
            <a href="/network/">Network</a> /
            <a href="/network/chat/">Chat</a> /
            {{ if .TempConnect }}
                <i>{{ .TempConnect }}</i>
            {{ else }}
                <i>None</i>
            {{ end }}
        </p>
    </div>
    <hr>
    <div class="content block_left">
        {{ if .TempConnect }}
            <br>
            <form method="POST" accept="/network/chat/">
                <b>
                    <a href="/network/profile/{{ .TempConnect }}">Profile</a> | 
                    <a href="/network/chat/{{ .TempConnect }}">Chat</a> | 
                    <a href="/network/email/read/{{ .TempConnect }}">Email</a> | 
                    <a href="/network/archive/{{ .TempConnect }}">Archive</a> | 
                </b>
                <br>
                <select id="selected_connection" onchange="change_connection();">
                    <option>Connections</option>
                    <option>Global</option>
                    {{ if .Connections }}
                        {{ range .Connections }}
                            <option><a href="/network/chat/{{ . }}">{{ . }}</a></option>
                        {{ end }}
                    {{ end }}
                </select>
                <input type="submit" name="delete_message" value="Delete messages">
            </form>
            <form method="POST" action="/network/chat/{{ .TempConnect }}">
                <textarea id="plain" readonly>{{ range .Messages }}{{ . }}{{ end }}</textarea> <br>
                <input class="input_size" type="text" name="text" placeholder="Message...">
                <br>
                <input autofocus type="submit" name="send_message" value="Send message">
            </form>
            <script type="text/javascript">
                function show() {  
                    $.ajax({  
                        type: "POST",
                        url: "/api/chat/{{ .TempConnect }}/update",  
                        cache: false,  
                        success: function(obj) {
                            console.log(obj);
                            if (obj.Exists) {
                                $("#plain").html($("#plain").val() + obj.Body);  
                            }
                        },
                    }).done(function(obj){
                        show();
                    });  
                }  
                $(document).ready(function(){  
                    show();
                });
            </script>
            <script type="text/javascript" src="/static/js/ajax/change_connection.js"></script>
        {{ else }}
            Nothing
        {{ end }}
    </div>
{{ end }}
